# TP2 : Environnement virtuel

## Compte-rendu

☀️ Sur **`node1.lan1.tp2`**

```
[lm33@node1lan1tp2 ~]$ ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: enp0s8: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 08:00:27:de:08:94 brd ff:ff:ff:ff:ff:ff
    inet 10.1.1.11/24 brd 10.1.1.255 scope global noprefixroute enp0s8
       valid_lft forever preferred_lft forever
    inet6 fe80::a00:27ff:fede:894/64 scope link 
       valid_lft forever preferred_lft forever

[lm33@node1lan1tp2 ~]$ ip r s
default via 10.1.1.254 dev enp0s8 proto static metric 100 
10.1.1.0/24 dev enp0s8 proto kernel scope link src 10.1.1.11 metric 100 

[lm33@node1lan1tp2 ~]$ ping 10.1.2.12
PING 10.1.2.12 (10.1.2.12) 56(84) bytes of data.
64 bytes from 10.1.2.12: icmp_seq=1 ttl=63 time=0.786 ms
64 bytes from 10.1.2.12: icmp_seq=2 ttl=63 time=1.21 ms
^C
--- 10.1.2.12 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1062ms
rtt min/avg/max/mdev = 0.786/0.998/1.211/0.212 ms

[lm33@node1lan1tp2 ~]$ traceroute 10.1.2.12
traceroute to 10.1.2.12 (10.1.2.12), 30 hops max, 60 byte packets
 1  _gateway (10.1.1.254)  0.411 ms  0.372 ms  0.360 ms
 2  10.1.2.12 (10.1.2.12)  0.696 ms !X  0.684 ms !X  0.673 ms !X
```

# II. Interlude accès internet

☀️ **Sur `router.tp2`**

```
[lm33@routertp2 ~]$ ping 1.1.1.1
PING 1.1.1.1 (1.1.1.1) 56(84) bytes of data.
64 bytes from 1.1.1.1: icmp_seq=1 ttl=63 time=56.4 ms
64 bytes from 1.1.1.1: icmp_seq=2 ttl=63 time=61.1 ms
^C
--- 1.1.1.1 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1002ms
rtt min/avg/max/mdev = 56.407/58.733/61.059/2.326 ms

[lm33@routertp2 ~]$ ping crunchyroll.com
PING crunchyroll.com (104.18.34.202) 56(84) bytes of data.
64 bytes from 104.18.34.202 (104.18.34.202): icmp_seq=1 ttl=63 time=37.9 ms
64 bytes from 104.18.34.202 (104.18.34.202): icmp_seq=2 ttl=63 time=49.0 ms
^C
--- crunchyroll.com ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1000ms
rtt min/avg/max/mdev = 37.855/43.412/48.969/5.557 ms
```

☀️ **Accès internet LAN1 et LAN2**

```
[lm33@node2lan1tp2 ~]$ cat /etc/sysconfig/network
GATEWAY=10.1.1.254

[lm33@node2lan1tp2 ~]$ cat /etc/resolv.conf 
# Generated by NetworkManager
nameserver 1.1.1.1

[lm33@node2lan1tp2 ~]$ ping 8.8.8.8
PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.
64 bytes from 8.8.8.8: icmp_seq=1 ttl=61 time=54.9 ms
64 bytes from 8.8.8.8: icmp_seq=2 ttl=61 time=37.8 ms
^C
--- 8.8.8.8 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1001ms
rtt min/avg/max/mdev = 37.819/46.381/54.944/8.562 ms

[lm33@node2lan1tp2 ~]$ ping animationdigitalnetwork.fr
PING animationdigitalnetwork.fr (52.222.169.125) 56(84) bytes of data.
64 bytes from server-52-222-169-125.cdg52.r.cloudfront.net (52.222.169.125): icmp_seq=1 ttl=61 time=24.2 ms
64 bytes from server-52-222-169-125.cdg52.r.cloudfront.net (52.222.169.125): icmp_seq=2 ttl=61 time=32.4 ms
^C
--- animationdigitalnetwork.fr ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1002ms
rtt min/avg/max/mdev = 24.217/28.309/32.402/4.092 ms
```

# III. Services réseau

## 1. DHCP

☀️ **Sur `dhcp.lan1.tp2`**

```
[lm33@dhcplan1tp2 ~]$ hostname
dhcplan1tp2
[lm33@dhcplan1tp2 ~]$ ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: enp0s8: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 08:00:27:96:94:48 brd ff:ff:ff:ff:ff:ff
    inet 10.1.1.253/24 brd 10.1.1.255 scope global secondary noprefixroute enp0s8
       valid_lft forever preferred_lft forever
    inet6 fe80::a00:27ff:fe96:9448/64 scope link 
       valid_lft forever preferred_lft forever
[lm33@dhcplan1tp2 ~]$ sudo dnf install dhcp-server -y
[lm33@dhcplan1tp2 ~]$ sudo !!
sudo cat /etc/dhcp/dhcpd.conf
#
# DHCP Server Configuration file.
#   see /usr/share/doc/dhcp-server/dhcpd.conf.example
#   see dhcpd.conf(5) man page
#
# create new
# default lease time
default-lease-time 600;
# max lease time
max-lease-time 7200;
# this DHCP server to be declared valid
authoritative;
# specify network address and subnetmask
subnet 10.1.1.0 netmask 255.255.255.0 {
    # specify the range of lease IP address
    range dynamic-bootp 10.1.1.100 10.1.1.200;
    # specify broadcast address
    option broadcast-address 10.0.0.255;
    # specify gateway
    option routers 10.1.1.254;
}
[lm33@dhcplan1tp2 ~]$ systemctl status  dhcpd
● dhcpd.service - DHCPv4 Server Daemon
     Loaded: loaded (/usr/lib/systemd/system/dhcpd.service; enabled; preset: disabled)
     Active: active (running) since Sun 2023-10-22 21:04:45 CEST; 7min ago
       Docs: man:dhcpd(8)
             man:dhcpd.conf(5)
   Main PID: 1772 (dhcpd)
     Status: "Dispatching packets..."
      Tasks: 1 (limit: 4611)
     Memory: 5.2M
        CPU: 5ms
     CGroup: /system.slice/dhcpd.service
             └─1772 /usr/sbin/dhcpd -f -cf /etc/dhcp/dhcpd.conf -user dhcpd -group dhcpd --no-pid

Oct 22 21:04:45 dhcplan1tp2 dhcpd[1772]: Config file: /etc/dhcp/dhcpd.conf
Oct 22 21:04:45 dhcplan1tp2 dhcpd[1772]: Database file: /var/lib/dhcpd/dhcpd.leases
Oct 22 21:04:45 dhcplan1tp2 dhcpd[1772]: PID file: /var/run/dhcpd.pid
Oct 22 21:04:45 dhcplan1tp2 dhcpd[1772]: Source compiled to use binary-leases
Oct 22 21:04:45 dhcplan1tp2 dhcpd[1772]: Wrote 0 leases to leases file.
Oct 22 21:04:45 dhcplan1tp2 dhcpd[1772]: Listening on LPF/enp0s8/08:00:27:96:94:48/10.1.1.0/24
Oct 22 21:04:45 dhcplan1tp2 dhcpd[1772]: Sending on   LPF/enp0s8/08:00:27:96:94:48/10.1.1.0/24
Oct 22 21:04:45 dhcplan1tp2 dhcpd[1772]: Sending on   Socket/fallback/fallback-net
Oct 22 21:04:45 dhcplan1tp2 dhcpd[1772]: Server starting service.
Oct 22 21:04:45 dhcplan1tp2 systemd[1]: Started DHCPv4 Server Daemon.

```

☀️ **Sur `node1lan1tp2`**

```
[lm33@node1lan1tp2 ~]$ cat /etc/sysconfig/network-scripts/ifcfg-enp0s8 
DEVICE=enp0s8

BOOTPROTO=dhcp
ONBOOT=yes
[lm33@node1lan1tp2 ~]$ sudo nmcli con reload
[lm33@node1lan1tp2 ~]$ sudo nmcli con up "System enp0s8"
[lm33@node1lan1tp2 ~]$ sudo systemctl restart NetworkManager
[lm33@node1lan1tp2 ~]$ ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: enp0s8: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 08:00:27:de:08:94 brd ff:ff:ff:ff:ff:ff
    inet 10.1.1.100/24 brd 10.1.1.255 scope global dynamic noprefixroute enp0s8
       valid_lft 429sec preferred_lft 429sec
    inet6 fe80::a00:27ff:fede:894/64 scope link 
       valid_lft forever preferred_lft forever
[lm33@node1lan1tp2 ~]$ ip r s
default via 10.1.1.254 dev enp0s8 proto dhcp src 10.1.1.100 metric 100 
10.1.1.0/24 dev enp0s8 proto kernel scope link src 10.1.1.100 metric 100 
[lm33@node1lan1tp2 ~]$ ping 10.1.2.11
PING 10.1.2.11 (10.1.2.11) 56(84) bytes of data.
64 bytes from 10.1.2.11: icmp_seq=1 ttl=63 time=0.772 ms
64 bytes from 10.1.2.11: icmp_seq=2 ttl=63 time=1.42 ms
64 bytes from 10.1.2.11: icmp_seq=3 ttl=63 time=1.32 ms
^C
--- 10.1.2.11 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2070ms
rtt min/avg/max/mdev = 0.772/1.169/1.418/0.283 ms
```

## 2. Web web web

☀️ **Sur `web.lan2.tp2`**

```
[lm33@weblan2tp2 ~]$ cat /etc/hostname 
weblan2tp2
[lm33@weblan2tp2 ~]$ sudo dnf install nginx
[lm33@weblan2tp2 ~]$ sudo mkdir /var/www
[lm33@weblan2tp2 ~]$ sudo mkdir /var/www/site_nul/
[lm33@weblan2tp2 ~]$ cat /etc/nginx/nginx.conf
# For more information on configuration, see:
#   * Official English Documentation: http://nginx.org/en/docs/
#   * Official Russian Documentation: http://nginx.org/ru/docs/

user nginx;
worker_processes auto;
error_log /var/log/nginx/error.log;
pid /run/nginx.pid;

# Load dynamic modules. See /usr/share/doc/nginx/README.dynamic.
include /usr/share/nginx/modules/*.conf;

events {
    worker_connections 1024;
}

http {
    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';

    access_log  /var/log/nginx/access.log  main;

    sendfile            on;
    tcp_nopush          on;
    tcp_nodelay         on;
    keepalive_timeout   65;
    types_hash_max_size 4096;

    include             /etc/nginx/mime.types;
    default_type        application/octet-stream;

    # Load modular configuration files from the /etc/nginx/conf.d directory.
    # See http://nginx.org/en/docs/ngx_core_module.html#include
    # for more information.
    include /etc/nginx/conf.d/*.conf;

    server {
        listen       80;
        listen       [::]:80;
        server_name  _;
        root         /var/www/site_nul/;

        # Load configuration files for the default server block.
        include /etc/nginx/default.d/*.conf;

        error_page 404 /404.html;
        location = /404.html {
        }

        error_page 500 502 503 504 /50x.html;
        location = /50x.html {
        }
    }
}
[lm33@weblan2tp2 ~]$ systemctl status nginx
● nginx.service - The nginx HTTP and reverse proxy server
     Loaded: loaded (/usr/lib/systemd/system/nginx.service; enabled; preset: disabled)
     Active: active (running) since Tue 2023-10-24 19:33:17 CEST; 8min ago
    Process: 1575 ExecStartPre=/usr/bin/rm -f /run/nginx.pid (code=exited, status=0/SUCCESS)
    Process: 1576 ExecStartPre=/usr/sbin/nginx -t (code=exited, status=0/SUCCESS)
    Process: 1577 ExecStart=/usr/sbin/nginx (code=exited, status=0/SUCCESS)
   Main PID: 1578 (nginx)
      Tasks: 2 (limit: 4611)
     Memory: 1.9M
        CPU: 13ms
     CGroup: /system.slice/nginx.service
             ├─1578 "nginx: master process /usr/sbin/nginx"
             └─1579 "nginx: worker process"

Oct 24 19:33:17 weblan2tp2 systemd[1]: Starting The nginx HTTP and reverse proxy server...
Oct 24 19:33:17 weblan2tp2 nginx[1576]: nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
Oct 24 19:33:17 weblan2tp2 nginx[1576]: nginx: configuration file /etc/nginx/nginx.conf test is successful
Oct 24 19:33:17 weblan2tp2 systemd[1]: Started The nginx HTTP and reverse proxy server.
[lm33@weblan2tp2 ~]$ sudo firewall-cmd --add-port=80/tcp --permanent
success
[lm33@weblan2tp2 ~]$ sudo firewall-cmd --reload
success
[lm33@weblan2tp2 ~]$ sudo ss -alutnp | grep 80
tcp   LISTEN 0      511          0.0.0.0:80        0.0.0.0:*    users:(("nginx",pid=1579,fd=6),("nginx",pid=1578,fd=6))
tcp   LISTEN 0      511             [::]:80           [::]:*    users:(("nginx",pid=1579,fd=7),("nginx",pid=1578,fd=7))
[lm33@weblan2tp2 ~]$ sudo firewall-cmd --list-all | grep ports
  ports: 80/tcp
  forward-ports: 
  source-ports: 
```

☀️ **Sur `node1lan1tp2`**

```
[lm33@node1lan1tp2 ~]$ cat /etc/hosts
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
10.1.2.12   site_nul.tp2
[lm33@node1lan1tp2 ~]$ curl site_nul.tp2
<p>MIAOOOOOOOUUUUU<p/>
```